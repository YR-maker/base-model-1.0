# 默认配置继承链
defaults:
  - train
  # 使用纯净数据配置 (无 TopoMask 遮罩)
  - override data: imageCAS
  - _self_

# 实验参数
num_shots: 3
lr: 0.00001
devices: [2,3,6,7]
devices_num: 8
run_name: TC_loss

data_name: imageCAS
loss_name: tversky+cldice

path_to_chkpt: /home/yangrui/Project/Base-model/local_results/checkpoints/base.pt
chkpt_folder: /home/yangrui/Project/Base-model/local_results/checkpoints

dataloader:
  shuffle: False

trainer:
  lightning_trainer:
    val_check_interval: 200
    max_steps: 10000
    max_epochs: 10

  # Lightning 模块配置 (直接使用标准微调模块)
  lightning_module:
    _target_: model.module.PLModuleFinetune
    _partial_: True
    prediction_threshold: 0.62
    batch_size: ${batch_size}
    input_size: ${input_size}

    # 学习率调度器
    scheduler_configs:
      cosine_annealing_few:
        interval: step
        frequency: 10
        scheduler:
          _target_: torch.optim.lr_scheduler.CosineAnnealingLR
          _partial_: True
          T_max: 1000
          eta_min: 0.0000001
          last_epoch: -1
      linear_warmup: null
      cosine_annealing: null

  # 【核心修改】将 Loss 替换为我们新写的 HybridVesselLoss
  # 这会被注入到 PLModuleFinetune 的 self.loss 中
  loss:
    _target_: utils.orther_loss.losses.HybridVesselLoss
    # Tversky 参数：beta > alpha 强迫模型提高 Recall，减少断裂
    alpha: 0.3
    beta: 0.7
    # clDice 参数
    iter_: 3
    # 权重分配：Tversky 为主，clDice 为辅
    lambda_main: 1.0
    lambda_cldice: 0.4