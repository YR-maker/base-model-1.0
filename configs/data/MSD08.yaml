defaults:
  - default_finetune@MSD8
  - _self_

MSD8:
  sample_prop: 1
  path: /home/yangrui/Project/Base-model/datasets/MSD08/MSD-61  #TODO

  transforms:
    train:
      - EnsureChannelFirstd:
          keys: ["Image", "Mask"]
          channel_dim: "no_channel"
      - CropForegroundd:
          keys: ["Image", "Mask"]
          source_key: "Mask"
          crop_foreground: True
#      - CenterSpatialCropd:
#          keys: ["Image", "Mask"]
#          roi_size: ${input_size}
      # =======================================================
      # 【修改点】将 CenterSpatialCropd 替换为 RandSpatialCropd
      # =======================================================
      - RandSpatialCropd:
          keys: ["Image", "Mask"]
          roi_size: ${input_size}
          random_center: True    # 开启随机中心点
          random_size: False     # 固定裁剪尺寸为 input_size (如128)，不改变大小
      # =======================================================
      - ScaleIntensityd:
          keys: ["Image"]
          minv: 0
          maxv: 1
      - RandZoomd:
          keys: ["Image", "Mask"]
          prob: 0.3
          min_zoom: 1
          max_zoom: 1.3
          mode: ["bilinear", "nearest"]
          padding_mode: "zeros"
      - SpatialPadd:
          keys: ["Image", "Mask"]
          spatial_size: ${input_size}
          mode: "constant"
          method: "symmetric"
      - RandAffined:
          keys: ["Image", "Mask"]
          prob: 0.3
          shear_range: [0.4, 0.4, 0.4]
          mode: ["bilinear", "nearest"]
          padding_mode: "zeros"
      - RandFlipd:
          keys: ["Image", "Mask"]
          prob: 0.3
          spatial_axis: 0
      - RandFlipd:
          keys: ["Image", "Mask"]
          prob: 0.3
          spatial_axis: 1
      - RandGaussianNoised:
          keys: ["Image"]
          prob: 0.2
          std: 0.01
          mean: 0.3
      - RandKSpaceSpikeNoised:
          keys: ["Image"]
          prob: 0.2
          intensity_range: [0.0, 0.5]

      - ToTensord:
          keys: ["Image", "Mask"]
    val:
      - EnsureChannelFirstd:
          keys: ["Image", "Mask"]
          channel_dim: "no_channel"
      - CropForegroundd:
          keys: ["Image", "Mask"]
          source_key: "Mask"
          crop_foreground: True
      - ScaleIntensityRangePercentilesd:
          keys: ["Image"]
          lower: 2
          upper: 98
          b_min: 0
          b_max: 1
      - ToTensord:
          keys: [Image, Mask]
    test:
      - EnsureChannelFirstd:
          keys: ["Image", "Mask"]
          channel_dim: "no_channel"
      - CropForegroundd:
          keys: ["Image", "Mask"]
          source_key: "Mask"
          crop_foreground: True
      - ScaleIntensityRangePercentilesd:
          keys: ["Image"]
          lower: 2
          upper: 98
          b_min: 0
          b_max: 1
      - ToTensord:
          keys: [Image, Mask]